webpackJsonp([28,35],{Kx0J:function(t,e){},ik39:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={components:{"v-map":n("qGk0").default}},l={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"bmap-wrapper"},[e("v-map")],1)},staticRenderFns:[]},a=n("C7Lr")(i,l,!1,null,null,null);e.default=a.exports},qGk0:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("4YfN"),l=n.n(i),a=n("jkKj"),o=n.n(a),s=n("R4Sj"),r={data:function(){return{cellName:"",myDis:null,allPoints:[],points:[],bm:null,convertor:null,planTable:null,NeiplanResult:null,ploygonStyle:{strokeColor:"red",strokeWeight:1,strokeOpacity:1,fillColor:"red",fillOpacity:.5,opts:"hello"},ploygonStyle_1:{strokeColor:"orange",strokeWeight:1,strokeOpacity:1,fillColor:"orange",fillOpacity:.5,opts:"hello"},ploygonStyle_2:{strokeColor:"pink",strokeWeight:1,strokeOpacity:1,fillColor:"pink",fillOpacity:.5,opts:"hello"},bs:null,isShowAllTable:!0,isShowPlanTable:!1,currentCell:""}},created:function(){sessionStorage.getItem("pname")&&this.setpname_prom(sessionStorage.getItem("pname")),this.getTable(),window.addEventListener("beforeunload",function(){sessionStorage.setItem("pname",sessionStorage.getItem("pname"))})},mounted:function(){var t=this;this.$nextTick(function(){t.initMap()}),console.log()},methods:l()({},Object(s.d)(["setpname_prom"]),{rangeBtn:function(){this.myDis.open()},initMap:function(){var t=new o.a.Map("allmap");this.bm=t;var e=new o.a.Point(102.772465,24.985747);this.bm.centerAndZoom(e,14),this.myDis=new BMapLib.DistanceTool(t),this.convertor=new o.a.Convertor,this.bm.enableScrollWheelZoom(!0),this.bm.addControl(new o.a.MapTypeControl({mapTypes:[BMAP_NORMAL_MAP,BMAP_HYBRID_MAP]}));var n=this;t.addEventListener("dragend",function(){n.points=[],n.allPoints.length&&(n.getCounts(this),n.draw(n.points,n.ploygonStyle))})},Sector1:function(t,e,n,i,l,a,o,s,r,c){var u=[],p=(i-n)/10||10;u.push(t);for(var h=n;h<i+.001;h+=p)u.push(this.EOffsetBearing(t,e,h));return u.push(t),u},EOffsetBearing:function(t,e,n){var i=10*this.bm.getDistance(t,new o.a.Point(t.lng+.1,t.lat)),l=10*this.bm.getDistance(t,new o.a.Point(t.lng,t.lat+.1)),a=e*Math.sin(n*Math.PI/180)/l,s=e*Math.cos(n*Math.PI/180)/i;return new o.a.Point(t.lng+s,t.lat+a)},addMarker:function(){this.getCounts(this.bm),this.draw(this.points,this.ploygonStyle)},setInfoWindow:function(t){var e="";for(var n in t)e+="<p style='margin:0;line-height:20px;font-size:13px;width:250px'><span style='display:inline-block;width:160px'>"+n+":</span>"+t[n]+"</p>";var i='<div style="height: 100px; overflow-y: scroll;margin-top:10px">'+e+"</div>";return new o.a.InfoWindow(i)},removeMarker:function(){this.bm.clearOverlays(),this.points=[]},translateCallback:function(t){0===t.status&&this.bm.centerAndZoom(t.points[0],14)},choiceCell:function(t,e){for(var n=document.querySelectorAll(".cell-item"),i=n.length-1;i>=0;i--)n[i].classList.remove("choiced");t.target.classList.add("choiced");var l=new o.a.Point(e.Longitude,e.Latitude),a=[];a.push(l),this.convertor.translate(a,1,5,this.translateCallback)},getTable:function(){var t=this,e={headers:{username:JSON.parse(sessionStorage.user).username,projectname:sessionStorage.pname,filetype:"map"}};this.$http.post(this.user.httppath+"api/Geo/GetAllTable?neifiletype=lte",{neifiletype:"lte"},e).then(function(e){console.log(e),t.allPoints=e.allTable.slice(0,1e4),t.planTable=e.planTable})},getCounts:function(t){var e=this;this.bs=t.getBounds(),this.allPoints.forEach(function(t){var n=new o.a.Point(t.Longitude,t.Latitude);e.bs.containsPoint(n)&&e.points.push(t)})},draw:function(t,e){var n=this,i=this.bm,l=t.length,a=l/10+1;if(a>1)for(var s=function(a){for(var s=[],r=[],c=0;c<10;c++)if(10*a+c<l){var u=new o.a.Point(t[10*a+c].Longitude,t[10*a+c].Latitude),p=t[10*a+c];s.push(u),r.push(p)}var h=n;n.convertor.translate(s,1,5,function(t){if(0===t.status)for(var n=function(n){var l=r[n].Dir,a=new o.a.Polygon(h.Sector1(t.points[n],100,90-l-20,90-l+20),e),s=h.setInfoWindow(r[n]);i.addOverlay(a),a.onclick=function(e){i.openInfoWindow(s,new o.a.Point(t.points[n].lng,t.points[n].lat)),h.currentCell=r[n]}},l=0;l<t.points.length;l++)n(l)})},r=0;r<a;r++)s(r)},showNeiplan:function(){this.draw(this.planTable,this.ploygonStyle_1)},getNeiplanResult:function(){var t=this;if(this.currentCell){var e={headers:{username:JSON.parse(sessionStorage.user).username,projectname:sessionStorage.pname,filetype:"map"}};this.$http.post(this.user.httppath+"api/Geo/GetNeighborCell?neifiletype=lte",{servingcell:this.currentCell.Cell},e).then(function(e){if(t.NeiplanResult=e,"没有服务小区"!==e){t.draw(t.NeiplanResult,t.ploygonStyle_2);for(var n=[],i=0;i<t.NeiplanResult.length;i++){var l=[],a=new o.a.Point(t.NeiplanResult[i].Longitude,t.NeiplanResult[i].Latitude);l.push(a),t.convertor.translate(l,1,5,function(t){n.push(t.points[0])})}setTimeout(function(){var e=[];e.push(new o.a.Point(t.currentCell.Longitude,t.currentCell.Latitude)),t.convertor.translate(e,1,5,function(e){for(var i=0;i<n.length;i++){var l=new o.a.Point(e.points[0].lng,e.points[0].lat),a=new o.a.Point(n[i].lng,n[i].lat),s=new o.a.Polyline([l,a],{strokeColor:"red",strokeWeight:1,strokeOpacity:.5});t.bm.addOverlay(s)}})},500)}else t.$notify({title:"警告",message:"没有找到服务小区",type:"warning"})})}}}),computed:l()({},Object(s.e)({user:function(t){return t.user}}),{filterPoints:function(){var t=this;return this.allPoints.filter(function(e){return e.Cell.match(t.cellName.toUpperCase())})},isCell:function(){return 0===this.filterPoints.length}})},c={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"map-wrapper"},[n("div",{staticClass:"map-menu"},[n("el-row",{staticClass:"cell-list-header"},[t._v("站点列表")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.cellName,expression:"cellName"}],staticClass:"searchCell",attrs:{type:"text",name:"cellName",placeholder:"请输入搜索内容"},domProps:{value:t.cellName},on:{input:function(e){e.target.composing||(t.cellName=e.target.value)}}}),t._v(" "),t.isCell?n("div",{staticClass:"nothingCell"},[t._v("没有找到数据")]):n("ul",{staticClass:"cell-list"},[n("li",[n("div",{staticStyle:{cursor:"pointer"},on:{click:function(e){t.isShowAllTable=!t.isShowAllTable}}},[t._v("总表")]),t._v(" "),n("ul",{directives:[{name:"show",rawName:"v-show",value:t.isShowAllTable,expression:"isShowAllTable"}],staticClass:"list-item"},t._l(t.filterPoints,function(e){return n("li",{staticClass:"cell-item",on:{click:function(n){return t.choiceCell(n,e)}}},[t._v("\n            "+t._s(e.Cell)+"\n          ")])}),0)]),t._v(" "),n("li",[n("div",{staticStyle:{cursor:"pointer"},on:{click:function(e){t.isShowPlanTable=!t.isShowPlanTable}}},[t._v("邻区规划站点")]),t._v(" "),n("ul",{directives:[{name:"show",rawName:"v-show",value:t.isShowPlanTable,expression:"isShowPlanTable"}],staticClass:"list-item"},t._l(t.planTable,function(e){return n("li",{staticClass:"cell-item",on:{click:function(n){return t.choiceCell(n,e)}}},[t._v("\n            "+t._s(e.Cell)+"\n          ")])}),0)])])],1),t._v(" "),n("el-row",{staticClass:"map-content"},[n("el-row",{staticClass:"toolBar"},[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.showNeiplan}},[t._v("显示规划点位")]),t._v(" "),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return e.preventDefault(),t.addMarker(e)}}},[t._v("显示总表")]),t._v(" "),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.getNeiplanResult}},[t._v("获取邻区规划")])],1),t._v(" "),n("div",{staticStyle:{height:"400px",border:"1px solid lightgray"},attrs:{id:"allmap"}}),t._v(" "),n("button",{staticClass:"rangeBtn",on:{click:function(e){return e.preventDefault(),t.rangeBtn(e)}}},[t._v("测距")]),t._v(" "),n("el-button",{staticClass:"addMarker",on:{click:function(e){return e.preventDefault(),t.removeMarker(e)}}},[t._v("清空地图数据")])],1)],1)},staticRenderFns:[]};var u=n("C7Lr")(r,c,!1,function(t){n("Kx0J")},"data-v-6792ada6",null);e.default=u.exports}});
//# sourceMappingURL=28.b4e977072a31ab46aa2f.js.map