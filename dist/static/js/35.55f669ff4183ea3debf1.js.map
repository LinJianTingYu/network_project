{"version":3,"sources":["webpack:///src/pages/bmap/BMapComponent.vue","webpack:///./src/pages/bmap/BMapComponent.vue?dd28","webpack:///./src/pages/bmap/BMapComponent.vue"],"names":["BMapComponent","data","cellName","myDis","allPoints","points","bm","convertor","planTable","NeiplanResult","ploygonStyle","strokeColor","strokeWeight","strokeOpacity","fillColor","fillOpacity","opts","ploygonStyle_1","ploygonStyle_2","bs","isShowAllTable","isShowPlanTable","currentCell","created","sessionStorage","getItem","this","setpname_prom","getTable","window","addEventListener","setItem","mounted","_this","$nextTick","initMap","console","log","methods","extends_default","Object","vuex_esm","rangeBtn","open","map","external__BMap__default","a","Map","point","Point","centerAndZoom","BMapLib","DistanceTool","Convertor","enableScrollWheelZoom","addControl","MapTypeControl","mapTypes","BMAP_NORMAL_MAP","BMAP_HYBRID_MAP","self","length","getCounts","draw","Sector1","point2","radius","sDegree","eDegree","strokeColour","Strokepacity","fillColour","step","push","i","EOffsetBearing","point3","dist","bearing","lngConv","getDistance","lng","lat","latConv","Math","sin","PI","cos","addMarker","setInfoWindow","pointItem","infoWindowHtml","key","sContent","InfoWindow","removeMarker","clearOverlays","translateCallback","status","choiceCell","$event","cellItem","cellItems","document","querySelectorAll","classList","remove","target","add","Longitude","Latitude","pointArr","translate","_this2","heads","headers","username","JSON","parse","user","projectname","pname","filetype","$http","post","httppath","neifiletype","then","res","allTable","slice","_this3","getBounds","forEach","item","containsPoint","_this4","len","groupCount","_loop","pos","pointItems","j","_loop2","_i","deg","Dir","oval","Polygon","infoWindow","addOverlay","onclick","e","openInfoWindow","showNeiplan","getNeiplanResult","_this5","servingcell","Cell","pointArray","setTimeout","stratPoint","point1","polyline","Polyline","$notify","title","message","type","computed","state","filterPoints","_this6","filter","match","toUpperCase","isCell","bmap_BMapComponent","render","_vm","_h","$createElement","_c","_self","staticClass","_v","directives","name","rawName","value","expression","attrs","placeholder","domProps","on","input","composing","staticStyle","cursor","click","_l","_s","size","preventDefault","height","border","id","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/35.55f669ff4183ea3debf1.js","sourcesContent":["<template>\r\n  <div class=\"map-wrapper\">\r\n    <div class=\"map-menu\">\r\n      <el-row class=\"cell-list-header\">站点列表</el-row>\r\n      <input type=\"text\"\r\n             name=\"cellName\"\r\n             class=\"searchCell\"\r\n             placeholder=\"请输入搜索内容\"\r\n             v-model=\"cellName\">\r\n      <div class=\"nothingCell\"\r\n           v-if=\"isCell\">没有找到数据</div>\r\n      <ul class=\"cell-list\"\r\n          v-else>\r\n        <li>\r\n          <div @click=\"{{isShowAllTable = !isShowAllTable}}\" style=\"cursor: pointer;\">总表</div>\r\n          <ul class=\"list-item\" v-show=\"isShowAllTable\">\r\n            <li class=\"cell-item\"\r\n              v-for=\"cellItem in filterPoints\"\r\n              @click=\"choiceCell($event,cellItem)\">\r\n              {{cellItem.Cell}}\r\n            </li>\r\n          </ul>\r\n        </li>\r\n        <li>\r\n          <div @click=\"{{isShowPlanTable = !isShowPlanTable}}\" style=\"cursor: pointer;\">邻区规划站点</div>\r\n          <ul class=\"list-item\" v-show=\"isShowPlanTable\">\r\n            <li class=\"cell-item\"\r\n              v-for=\"cellItem in planTable\"\r\n              @click=\"choiceCell($event,cellItem)\">\r\n              {{cellItem.Cell}}\r\n            </li>\r\n          </ul>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n    <el-row class=\"map-content\">\r\n      <el-row class=\"toolBar\">\r\n        <el-button type=\"primary\" size=\"mini\" @click=\"showNeiplan\">显示规划点位</el-button>\r\n        <el-button type=\"primary\" size=\"mini\" @click.prevent=\"addMarker\">显示总表</el-button>\r\n        <el-button type=\"primary\" size=\"mini\" @click=\"getNeiplanResult\">获取邻区规划</el-button>\r\n      </el-row>\r\n      <div id=\"allmap\"\r\n           style=\"height: 400px; border: 1px solid lightgray\">\r\n      </div>\r\n      <!-- <div id=\"r-result\">请输入:<input type=\"text\" id=\"suggestId\" size=\"20\" value=\"百度\" style=\"width:150px;\" @highlight=\"\" /></div> -->\r\n      <!-- <div id=\"searchResultPanel\" style=\"border:1px solid #C0C0C0;width:150px;height:auto; display:none;\"></div> -->\r\n      <button @click.prevent=\"rangeBtn\"\r\n              class=\"rangeBtn\">测距</button>\r\n      <el-button @click.prevent=\"removeMarker\"\r\n              class=\"addMarker\">清空地图数据</el-button>\r\n    </el-row>\r\n  </div>\r\n</template>\r\n\r\n<script type=\"text/javascript\">\r\nimport BMap from 'BMap'\r\nimport { mapMutations, mapState } from 'vuex'\r\nexport default {\r\n  data () {\r\n    return {\r\n      cellName: '',\r\n      myDis: null,\r\n      allPoints: [],\r\n      points: [],\r\n      bm: null,\r\n      convertor: null,\r\n      planTable: null,\r\n      NeiplanResult: null,\r\n      // 多边形样式\r\n      ploygonStyle: {\r\n        strokeColor: 'red',\r\n        strokeWeight: 1,\r\n        strokeOpacity: 1,\r\n        fillColor: 'red',\r\n        fillOpacity: 0.5,\r\n        opts: 'hello'\r\n      },\r\n      ploygonStyle_1: {\r\n        strokeColor: 'orange',\r\n        strokeWeight: 1,\r\n        strokeOpacity: 1,\r\n        fillColor: 'orange',\r\n        fillOpacity: 0.5,\r\n        opts: 'hello'\r\n      },\r\n      ploygonStyle_2: {\r\n        strokeColor: 'pink',\r\n        strokeWeight: 1,\r\n        strokeOpacity: 1,\r\n        fillColor: 'pink',\r\n        fillOpacity: 0.5,\r\n        opts: 'hello'\r\n      },\r\n      // 可视区域\r\n      bs: null,\r\n      isShowAllTable: true,\r\n      isShowPlanTable: false,\r\n      currentCell: ''\r\n    }\r\n  },\r\n  created () {\r\n    if (sessionStorage.getItem('pname')) {\r\n      this.setpname_prom(sessionStorage.getItem('pname'))\r\n    }\r\n    // 获取邻区关系表\r\n    // 获取总表及规划站点\r\n    // 获取总表站点\r\n    this.getTable()\r\n    // 在页面刷新时将vuex里的信息保存到localStorage里\r\n    window.addEventListener('beforeunload', () => {\r\n      sessionStorage.setItem('pname', sessionStorage.getItem('pname'))\r\n    })\r\n  },\r\n  mounted () {\r\n    this.$nextTick(() => {\r\n      this.initMap()\r\n    })\r\n    console.log()\r\n  },\r\n  methods: {\r\n    ...mapMutations(['setpname_prom']),\r\n    // 点击打开测距功能\r\n    rangeBtn () {\r\n      this.myDis.open()\r\n      // 关闭鼠标测\r\n      // myDis.close()\r\n    },\r\n    // 初始化地图\r\n    initMap () {\r\n      // 创建Map实例\r\n      let map = new BMap.Map('allmap')\r\n      this.bm = map\r\n      // 地图初始化\r\n      let point = new BMap.Point(102.772465, 24.985747)\r\n      this.bm.centerAndZoom(point, 14)\r\n      this.myDis = new BMapLib.DistanceTool(map)\r\n      // 创建点\r\n      // this.bm.centerAndZoom('昆明', 13)\r\n      // 设置地图显示的城市 此项是必须设置\r\n      // this.bm.setCurrentCity('昆明')\r\n      // 地图坐标转换\r\n      this.convertor = new BMap.Convertor()\r\n      // 开启鼠标滚轮缩放\r\n      this.bm.enableScrollWheelZoom(true)\r\n      // 添加地图类型控件\r\n      this.bm.addControl(new BMap.MapTypeControl({\r\n        mapTypes: [\r\n          BMAP_NORMAL_MAP,\r\n          BMAP_HYBRID_MAP\r\n        ]\r\n      }))\r\n      // 获取当前地图视图\r\n      const self = this\r\n      map.addEventListener('dragend', function () {\r\n        self.points = []\r\n        if (self.allPoints.length) {\r\n          self.getCounts(this)\r\n          self.draw(self.points, self.ploygonStyle)\r\n        }\r\n      })\r\n    },\r\n    // 画出以point2点为圆心，半径为radius，夹角从sDegree到eDegree的扇形\r\n    Sector1 (point2, radius, sDegree, eDegree, strokeColour, strokeWeight, Strokepacity, fillColour, fillOpacity, opts) {\r\n      // 创建构成多边形的点数组\r\n      let points = []\r\n      // 根据扇形的总夹角确定每步夹角度数，最大为10\r\n      let step = ((eDegree - sDegree) / 10) || 10\r\n      points.push(point2)\r\n      // 循环获取每步的圆弧上点的坐标，存入点数组\r\n      for (let i = sDegree; i < eDegree + 0.001; i += step) {\r\n        points.push(this.EOffsetBearing(point2, radius, i))\r\n      }\r\n      points.push(point2)\r\n      return points\r\n    },\r\n    // 使用数学的方法计算需要画扇形的圆弧上的点坐标\r\n    EOffsetBearing (point3, dist, bearing) {\r\n      // 计算1经度与原点的距离\r\n      let lngConv = this.bm.getDistance(point3, new BMap.Point(point3.lng + 0.1, point3.lat)) * 10\r\n      // 计算1纬度与原点的距离\r\n      let latConv = this.bm.getDistance(point3, new BMap.Point(point3.lng, point3.lat + 0.1)) * 10\r\n      // 正弦计算待获取的点的纬度与原点纬度差\r\n      let lat = dist * Math.sin(bearing * Math.PI / 180) / latConv\r\n      // 余弦计算待获取的点的经度与原点经度差\r\n      let lng = dist * Math.cos(bearing * Math.PI / 180) / lngConv\r\n      return new BMap.Point(point3.lng + lng, point3.lat + lat)\r\n    },\r\n    // 批量导入站点\r\n    addMarker () {\r\n      this.getCounts(this.bm)\r\n      this.draw(this.points, this.ploygonStyle)\r\n    },\r\n    // 设置覆盖物信息框内的内容,传入站点信息\r\n    setInfoWindow (pointItem) {\r\n      let infoWindowHtml = ''\r\n      for (var key in pointItem) {\r\n        infoWindowHtml += \"<p style='margin:0;line-height:20px;font-size:13px;width:250px'><span style='display:inline-block;width:160px'>\" + key + ':</span>' + pointItem[key] + '</p>'\r\n      }\r\n      let sContent = '<div style=\"height: 100px; overflow-y: scroll;margin-top:10px\">' + infoWindowHtml + '</div>'\r\n      return new BMap.InfoWindow(sContent)\r\n    },\r\n    // 批量删除数据\r\n    removeMarker () {\r\n      this.bm.clearOverlays()\r\n      this.points = []\r\n    },\r\n    // 谷歌坐标转百度\r\n    translateCallback (data) {\r\n      if (data.status === 0) {\r\n        this.bm.centerAndZoom(data.points[0], 14)\r\n      }\r\n    },\r\n    // 列表中选中站名后执行\r\n    choiceCell ($event, cellItem) {\r\n      let cellItems = document.querySelectorAll('.cell-item')\r\n      for (var i = cellItems.length - 1; i >= 0; i--) {\r\n        cellItems[i].classList.remove('choiced')\r\n      }\r\n      $event.target.classList.add('choiced')\r\n      // 跳转至对应点位\r\n      let point = new BMap.Point(cellItem.Longitude, cellItem.Latitude)\r\n      var pointArr = []\r\n      pointArr.push(point)\r\n      this.convertor.translate(pointArr, 1, 5, this.translateCallback)\r\n    },\r\n    // 获取所需表格\r\n    getTable () {\r\n      var heads = {\r\n        headers: {\r\n          'username': JSON.parse(sessionStorage.user).username,\r\n          'projectname': sessionStorage.pname,\r\n          'filetype': 'map'\r\n        }\r\n      }\r\n      this.$http.post(\r\n        this.user.httppath + 'api/Geo/GetAllTable?neifiletype=lte',\r\n        { neifiletype: 'lte' },\r\n        heads\r\n      ).then((res) => {\r\n        console.log(res)\r\n        this.allPoints = res.allTable.slice(0, 10000)\r\n        this.planTable = res.planTable\r\n      })\r\n    },\r\n    // 获取视区范围,并判断是否在可是在可视区域\r\n    getCounts (map) {\r\n      this.bs = map.getBounds()\r\n      this.allPoints.forEach((item) => {\r\n        let point = new BMap.Point(item.Longitude, item.Latitude)\r\n        if (this.bs.containsPoint(point)) {\r\n          this.points.push(item)\r\n        }\r\n      })\r\n    },\r\n    //\r\n    draw (points, ploygonStyle) {\r\n      let bm = this.bm\r\n      let len = points.length\r\n      let groupCount = len / 10 + 1\r\n\r\n      // 批量撒点只能一次加载10个，所以要分批次加载\r\n      if (groupCount > 1) {\r\n        for (let i = 0; i < groupCount; i++) {\r\n          let pos = []\r\n          let pointItems = []\r\n          for (let j = 0; j < 10; j++) {\r\n            if (i * 10 + j < len) {\r\n              // 设置百度经纬度\r\n              let point = new BMap.Point(points[(i * 10) + j].Longitude, points[(i * 10) + j].Latitude)\r\n              let pointItem = points[(i * 10) + j]\r\n              pos.push(point)\r\n              pointItems.push(pointItem)\r\n            }\r\n          }\r\n          const self = this\r\n          this.convertor.translate(pos, 1, 5, function (data) {\r\n            if (data.status === 0) {\r\n              for (let i = 0; i < data.points.length; i++) {\r\n                let deg = pointItems[i].Dir\r\n                // 画扇形\r\n                // 以画多边形区域的方法画扇形区域\r\n                let oval = new BMap.Polygon(self.Sector1(data.points[i], 100, -deg + 90 - 20, -deg + 90 + 20), ploygonStyle)\r\n                // 设置覆盖物信息框内的内容,传入站点信息\r\n                let infoWindow = self.setInfoWindow(pointItems[i])\r\n                bm.addOverlay(oval)\r\n                // 点击单个覆盖物时显示信息内容\r\n                oval.onclick = function (e) {\r\n                  bm.openInfoWindow(infoWindow, new BMap.Point(data.points[i].lng, data.points[i].lat))\r\n                  self.currentCell = pointItems[i]\r\n                }\r\n              }\r\n            }\r\n          })\r\n        }\r\n      }\r\n    },\r\n    showNeiplan () {\r\n      this.draw(this.planTable, this.ploygonStyle_1)\r\n    },\r\n    getNeiplanResult () {\r\n      if (!this.currentCell) {\r\n        return\r\n      }\r\n      var heads = {\r\n        headers: {\r\n          'username': JSON.parse(sessionStorage.user).username,\r\n          'projectname': sessionStorage.pname,\r\n          'filetype': 'map'\r\n        }\r\n      }\r\n      this.$http.post(\r\n        this.user.httppath + 'api/Geo/GetNeighborCell?neifiletype=lte',\r\n        {\r\n          servingcell: this.currentCell.Cell\r\n        },\r\n        heads\r\n      ).then((res) => {\r\n        this.NeiplanResult = res\r\n        if (res === '没有服务小区') {\r\n          this.$notify({\r\n            title: '警告',\r\n            message: '没有找到服务小区',\r\n            type: 'warning'\r\n          })\r\n          return\r\n        }\r\n        this.draw(this.NeiplanResult, this.ploygonStyle_2)\r\n        var points = []\r\n        for (var i = 0; i < this.NeiplanResult.length; i++) {\r\n          var pointArray = []\r\n          var point = new BMap.Point(this.NeiplanResult[i].Longitude, this.NeiplanResult[i].Latitude)\r\n          pointArray.push(point)\r\n          this.convertor.translate(pointArray, 1, 5, (data) => {\r\n            points.push(data.points[0])\r\n          })\r\n        }\r\n        setTimeout(() => {\r\n          var stratPoint = []\r\n          stratPoint.push(new BMap.Point(this.currentCell.Longitude, this.currentCell.Latitude))\r\n          this.convertor.translate(stratPoint, 1, 5, (data) => {\r\n            for (var i = 0; i < points.length; i++) {\r\n              // 与邻区规划站点连线\r\n              const point1 = new BMap.Point(data.points[0].lng, data.points[0].lat)\r\n              const point2 = new BMap.Point(points[i].lng, points[i].lat)\r\n              var polyline = new BMap.Polyline([\r\n                point1,\r\n                point2\r\n              ], {strokeColor: 'red', strokeWeight: 1, strokeOpacity: 0.5})\r\n              // 创建折线\r\n              this.bm.addOverlay(polyline)\r\n            }\r\n          })\r\n        }, 500)\r\n      })\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapState({\r\n      user: (state) => state.user\r\n    }),\r\n    filterPoints () {\r\n      return this.allPoints.filter((data) => {\r\n        return data.Cell.match(this.cellName.toUpperCase())\r\n      })\r\n    },\r\n\r\n    // 判断站点容器里是否有内容\r\n    isCell () {\r\n      return this.filterPoints.length === 0\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style type=\"text/css\" scoped>\r\nul,\r\nli {\r\n  list-style-type: none;\r\n}\r\n.map-wrapper {\r\n  margin: 20px 20px;\r\n  display: flex;\r\n}\r\n.map-menu {\r\n  width: 200px;\r\n  margin-right: 20px;\r\n  border: 1px solid #ebeef5;\r\n  border-radius: 5px;\r\n}\r\n.cell-list-header {\r\n  height: 40px;\r\n  line-height: 40px;\r\n  background: #f5f7fa;\r\n  border-bottom: 1px solid #ebeef5;\r\n  padding-left: 10px;\r\n  font-size: 16px;\r\n}\r\n.cell-list {\r\n  padding: 0 10px;\r\n  background: white;\r\n  height: 400px;\r\n  font-size: 15px;\r\n  overflow-y: scroll;\r\n}\r\n.nothingCell {\r\n  padding: 0 10px;\r\n  background: white;\r\n  height: 400px;\r\n  font-size: 15px;\r\n}\r\n.searchCell {\r\n  width: 100%;\r\n  border: 1px solid gray;\r\n  padding: 10px 8px;\r\n  box-sizing: border-box;\r\n  margin: 10px 0;\r\n  border-radius: 10px;\r\n  outline: none;\r\n}\r\n.list-item{\r\n  padding-left: 10px;\r\n}\r\n.cell-item.choiced {\r\n  color: #409eff;\r\n}\r\n.cell-item {\r\n  padding-bottom: 5px;\r\n  cursor: pointer;\r\n}\r\n.toolBar{\r\n  line-height: 50px;\r\n}\r\n.map-content {\r\n  width: 500px;\r\n  height: 400px;\r\n  flex: 1;\r\n}\r\nbutton.addMarker,\r\nbutton.removeMarker {\r\n  margin-top: 10px;\r\n  padding: 10px;\r\n}\r\nbutton.rangeBtn {\r\n  position: absolute;\r\n  right: 90px;\r\n  top: 61px;\r\n  border: 1px solid rgb(139, 164, 220);\r\n  background: white;\r\n  padding: 2px 6px;\r\n  font: 12px/1.3em arial, sans-serif;\r\n  text-align: center;\r\n  white-space: nowrap;\r\n  border-radius: 3px 0px 0px 3px;\r\n  color: black;\r\n  outline: none;\r\n  box-shadow: rgba(0, 0, 0, 0.35) 2px 2px 3px;\r\n}\r\n.cell-message-box {\r\n  width: 10px;\r\n  height: 10px;\r\n  background: red;\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n}\r\nimg {\r\n  top: 0;\r\n}\r\n</style>\n\n\n// WEBPACK FOOTER //\n// src/pages/bmap/BMapComponent.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"map-wrapper\"},[_c('div',{staticClass:\"map-menu\"},[_c('el-row',{staticClass:\"cell-list-header\"},[_vm._v(\"站点列表\")]),_vm._v(\" \"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.cellName),expression:\"cellName\"}],staticClass:\"searchCell\",attrs:{\"type\":\"text\",\"name\":\"cellName\",\"placeholder\":\"请输入搜索内容\"},domProps:{\"value\":(_vm.cellName)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.cellName=$event.target.value}}}),_vm._v(\" \"),(_vm.isCell)?_c('div',{staticClass:\"nothingCell\"},[_vm._v(\"没有找到数据\")]):_c('ul',{staticClass:\"cell-list\"},[_c('li',[_c('div',{staticStyle:{\"cursor\":\"pointer\"},on:{\"click\":function($event){{{_vm.isShowAllTable = !_vm.isShowAllTable}}}}},[_vm._v(\"总表\")]),_vm._v(\" \"),_c('ul',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.isShowAllTable),expression:\"isShowAllTable\"}],staticClass:\"list-item\"},_vm._l((_vm.filterPoints),function(cellItem){return _c('li',{staticClass:\"cell-item\",on:{\"click\":function($event){return _vm.choiceCell($event,cellItem)}}},[_vm._v(\"\\n            \"+_vm._s(cellItem.Cell)+\"\\n          \")])}),0)]),_vm._v(\" \"),_c('li',[_c('div',{staticStyle:{\"cursor\":\"pointer\"},on:{\"click\":function($event){{{_vm.isShowPlanTable = !_vm.isShowPlanTable}}}}},[_vm._v(\"邻区规划站点\")]),_vm._v(\" \"),_c('ul',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.isShowPlanTable),expression:\"isShowPlanTable\"}],staticClass:\"list-item\"},_vm._l((_vm.planTable),function(cellItem){return _c('li',{staticClass:\"cell-item\",on:{\"click\":function($event){return _vm.choiceCell($event,cellItem)}}},[_vm._v(\"\\n            \"+_vm._s(cellItem.Cell)+\"\\n          \")])}),0)])])],1),_vm._v(\" \"),_c('el-row',{staticClass:\"map-content\"},[_c('el-row',{staticClass:\"toolBar\"},[_c('el-button',{attrs:{\"type\":\"primary\",\"size\":\"mini\"},on:{\"click\":_vm.showNeiplan}},[_vm._v(\"显示规划点位\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"type\":\"primary\",\"size\":\"mini\"},on:{\"click\":function($event){$event.preventDefault();return _vm.addMarker($event)}}},[_vm._v(\"显示总表\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"type\":\"primary\",\"size\":\"mini\"},on:{\"click\":_vm.getNeiplanResult}},[_vm._v(\"获取邻区规划\")])],1),_vm._v(\" \"),_c('div',{staticStyle:{\"height\":\"400px\",\"border\":\"1px solid lightgray\"},attrs:{\"id\":\"allmap\"}}),_vm._v(\" \"),_c('button',{staticClass:\"rangeBtn\",on:{\"click\":function($event){$event.preventDefault();return _vm.rangeBtn($event)}}},[_vm._v(\"测距\")]),_vm._v(\" \"),_c('el-button',{staticClass:\"addMarker\",on:{\"click\":function($event){$event.preventDefault();return _vm.removeMarker($event)}}},[_vm._v(\"清空地图数据\")])],1)],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/_vue-loader@13.7.3@vue-loader/lib/template-compiler?{\"id\":\"data-v-6792ada6\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/_vue-loader@13.7.3@vue-loader/lib/selector.js?type=template&index=0!./src/pages/bmap/BMapComponent.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/_extract-text-webpack-plugin@3.0.2@extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-6792ada6\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=styles&index=0!./BMapComponent.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=script&index=0!./BMapComponent.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=script&index=0!./BMapComponent.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-6792ada6\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=template&index=0!./BMapComponent.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-6792ada6\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/bmap/BMapComponent.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}